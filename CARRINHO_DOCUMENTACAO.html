<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Documenta√ß√£o - Carrinho de Compras</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.8/dist/css/bootstrap.min.css" rel="stylesheet">
    <style>
        body {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 40px 0;
        }
        .container-doc {
            max-width: 1000px;
            margin: 0 auto;
        }
        .card {
            border-radius: 15px;
            box-shadow: 0 5px 20px rgba(0,0,0,0.2);
            border: none;
            margin-bottom: 30px;
        }
        .card-header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border-radius: 15px 15px 0 0 !important;
        }
        .header-main {
            background: white;
            padding: 40px;
            border-radius: 15px;
            text-align: center;
            margin-bottom: 30px;
        }
        .header-main h1 {
            color: #667eea;
            font-size: 2.5rem;
        }
        .feature-box {
            background: white;
            padding: 20px;
            border-radius: 10px;
            margin: 15px 0;
            border-left: 5px solid #667eea;
        }
        .code-block {
            background: #f8f9fa;
            border: 1px solid #ddd;
            padding: 15px;
            border-radius: 8px;
            overflow-x: auto;
            font-family: 'Courier New', monospace;
            font-size: 0.9rem;
            margin: 10px 0;
        }
        .flow-step {
            background: white;
            padding: 20px;
            margin: 15px 0;
            border-radius: 10px;
            border-left: 5px solid #28a745;
        }
        .step-number {
            display: inline-block;
            background: #28a745;
            color: white;
            width: 40px;
            height: 40px;
            border-radius: 50%;
            text-align: center;
            line-height: 40px;
            font-weight: bold;
            margin-right: 15px;
        }
    </style>
</head>
<body>
    <div class="container-doc">
        <!-- Header -->
        <div class="header-main">
            <h1>üõí Sistema de Carrinho de Compras</h1>
            <p class="lead">Documenta√ß√£o T√©cnica Completa</p>
        </div>

        <!-- Introdu√ß√£o -->
        <div class="card">
            <div class="card-header">
                <h5 class="mb-0">üìã O que foi implementado?</h5>
            </div>
            <div class="card-body">
                <p>Sistema completo de carrinho de compras com integra√ß√£o ao banco de dados <code>loja_online</code>. O fluxo permite:</p>
                <ul>
                    <li><strong>Adicionar produtos</strong> ao carrinho diretamente da p√°gina de loja (hub.php)</li>
                    <li><strong>Visualizar carrinho</strong> com tabela detalhada de produtos, pre√ßos e quantidades</li>
                    <li><strong>Atualizar quantidades</strong> ou remover itens do carrinho</li>
                    <li><strong>Finalizar compra</strong> com valida√ß√£o de estoque e transa√ß√£o SQL</li>
                    <li><strong>Indicador visual</strong> de itens no carrinho na navbar</li>
                </ul>
            </div>
        </div>

        <!-- Fluxo de Dados -->
        <div class="card">
            <div class="card-header">
                <h5 class="mb-0">üîÑ Fluxo de Funcionamento</h5>
            </div>
            <div class="card-body">
                <div class="flow-step">
                    <span class="step-number">1</span>
                    <strong>Cliente navega no hub.php</strong>
                    <p style="margin-top: 10px; color: #666;">Ver produtos dispon√≠veis com bot√£o "+ Carrinho" e campo de quantidade</p>
                </div>

                <div class="flow-step">
                    <span class="step-number">2</span>
                    <strong>Cliente clica em "+ Carrinho"</strong>
                    <p style="margin-top: 10px; color: #666;">Formul√°rio envia POST para carrinho.php com id_produto, id_loja e quantidade</p>
                </div>

                <div class="flow-step">
                    <span class="step-number">3</span>
                    <strong>PHP adiciona ao carrinho (sess√£o)</strong>
                    <p style="margin-top: 10px; color: #666;">Item armazenado em <code>$_SESSION['carrinho']</code> com chave √∫nica <code>id_produto_id_loja</code></p>
                </div>

                <div class="flow-step">
                    <span class="step-number">4</span>
                    <strong>Cliente visualiza carrinho</strong>
                    <p style="margin-top: 10px; color: #666;">Acessa <code>carrinho.php</code> para ver tabela com todos os itens, pre√ßos e subtotais</p>
                </div>

                <div class="flow-step">
                    <span class="step-number">5</span>
                    <strong>Cliente finaliza compra</strong>
                    <p style="margin-top: 10px; color: #666;">Clica bot√£o "Finalizar Compra". Sistema valida estoque e executa transa√ß√£o SQL</p>
                </div>

                <div class="flow-step" style="border-left-color: #dc3545;">
                    <span class="step-number" style="background: #dc3545;">6</span>
                    <strong>Transa√ß√£o SQL executada</strong>
                    <p style="margin-top: 10px; color: #666;">
                        ‚úì INSERT em Venda<br>
                        ‚úì INSERT m√∫ltiplo em ItemVenda<br>
                        ‚úì UPDATE em Estoque
                    </p>
                </div>

                <div class="flow-step" style="border-left-color: #28a745;">
                    <span class="step-number">7</span>
                    <strong>Compra confirmada</strong>
                    <p style="margin-top: 10px; color: #666;">Carrinho limpo, mensagem de sucesso com n√∫mero do pedido exibida</p>
                </div>
            </div>
        </div>

        <!-- Estrutura de Dados -->
        <div class="card">
            <div class="card-header">
                <h5 class="mb-0">üíæ Estrutura de Dados - Sess√£o</h5>
            </div>
            <div class="card-body">
                <p>O carrinho √© armazenado em <code>$_SESSION['carrinho']</code> como array associativo:</p>
                <div class="code-block">
&lt;?php
$_SESSION['carrinho'] = [
    '1_1' => [
        'id_produto' => 1,
        'id_loja' => 1,
        'quantidade' => 2
    ],
    '4_3' => [
        'id_produto' => 4,
        'id_loja' => 3,
        'quantidade' => 1
    ]
];
// Chave = "{id_produto}_{id_loja}"
?&gt;
                </div>
            </div>
        </div>

        <!-- Tabelas Banco de Dados -->
        <div class="card">
            <div class="card-header">
                <h5 class="mb-0">üóÑÔ∏è Tabelas Utilizadas do Banco de Dados</h5>
            </div>
            <div class="card-body">
                <h6 style="color: #667eea; margin-top: 20px;"><strong>1. Tabela: Venda</strong></h6>
                <div class="code-block">
CREATE TABLE Venda (
    id INT(4) AUTO_INCREMENT PRIMARY KEY,
    id_cliente INT(4) NOT NULL,
    id_loja INT(4) NOT NULL,
    data_venda DATETIME DEFAULT CURRENT_TIMESTAMP,
    valor_total DECIMAL(10, 2) DEFAULT 0.00,
    FOREIGN KEY (id_cliente) REFERENCES Cliente(id),
    FOREIGN KEY (id_loja) REFERENCES Loja(id)
);
                </div>

                <h6 style="color: #667eea; margin-top: 20px;"><strong>2. Tabela: ItemVenda</strong></h6>
                <div class="code-block">
CREATE TABLE ItemVenda (
    id INT(4) AUTO_INCREMENT PRIMARY KEY,
    id_venda INT(4) NOT NULL,
    id_produto INT(4) NOT NULL,
    quantidade INT(6) NOT NULL,
    preco_unitario DECIMAL(10, 2) NOT NULL,
    FOREIGN KEY (id_venda) REFERENCES Venda(id),
    FOREIGN KEY (id_produto) REFERENCES Produto(id)
);
                </div>

                <h6 style="color: #667eea; margin-top: 20px;"><strong>3. Tabela: CarrinhoTemporario (n√£o usada em sess√£o, opcional BD)</strong></h6>
                <div class="code-block">
CREATE TABLE CarrinhoTemporario (
    id_sessao VARCHAR(255) NOT NULL,
    id_produto INT(4) NOT NULL,
    quantidade INT(6) NOT NULL DEFAULT 1,
    PRIMARY KEY (id_sessao, id_produto),
    FOREIGN KEY (id_produto) REFERENCES Produto(id)
);
                </div>
                <p style="margin-top: 10px; color: #666; font-style: italic;">Nota: CarrinhoTemporario n√£o foi utilizado pois armazenamos em $_SESSION (mais r√°pido e sem persist√™ncia desnecess√°ria)</p>
            </div>
        </div>

        <!-- Transa√ß√£o SQL -->
        <div class="card">
            <div class="card-header">
                <h5 class="mb-0">‚öôÔ∏è Processo de Finaliza√ß√£o - Transa√ß√£o SQL</h5>
            </div>
            <div class="card-body">
                <h6 style="color: #667eea; margin-top: 20px;"><strong>1Ô∏è‚É£ Valida√ß√£o de Estoque (PR√â-TRANSA√á√ÉO)</strong></h6>
                <div class="code-block">
SELECT e.quantidade_disponivel, p.nome, l.cidade 
FROM Estoque e
INNER JOIN Produto p ON p.id = e.id_produto
INNER JOIN Loja l ON l.id = e.id_loja
WHERE e.id_produto = ? AND e.id_loja = ?;

// Verifica se: quantidade_disponivel >= quantidade_desejada
// Se falhar para algum item, transa√ß√£o n√£o √© iniciada
                </div>

                <h6 style="color: #667eea; margin-top: 20px;"><strong>2Ô∏è‚É£ Inserir Venda</strong></h6>
                <div class="code-block">
$pdo->beginTransaction();

INSERT INTO Venda (id_cliente, id_loja, valor_total) 
VALUES (?, ?, ?);

// Retorna $id_venda = $pdo->lastInsertId();
                </div>

                <h6 style="color: #667eea; margin-top: 20px;"><strong>3Ô∏è‚É£ Inserir Itens (Loop por cada produto)</strong></h6>
                <div class="code-block">
INSERT INTO ItemVenda (id_venda, id_produto, quantidade, preco_unitario) 
VALUES (?, ?, ?, ?);

// preco_unitario = preco - (tipo == 'Usado' ? desconto_usados : 0)
                </div>

                <h6 style="color: #667eea; margin-top: 20px;"><strong>4Ô∏è‚É£ Atualizar Estoque (Loop por cada produto)</strong></h6>
                <div class="code-block">
UPDATE Estoque 
SET quantidade_disponivel = quantidade_disponivel - ? 
WHERE id_produto = ? AND id_loja = ?;
                </div>

                <h6 style="color: #667eea; margin-top: 20px;"><strong>5Ô∏è‚É£ Confirmar Transa√ß√£o</strong></h6>
                <div class="code-block">
$pdo->commit();

// Se houver erro em qualquer etapa:
// $pdo->rollBack(); (desfaz TUDO)
                </div>
            </div>
        </div>

        <!-- C√°lculo de Pre√ßos -->
        <div class="card">
            <div class="card-header">
                <h5 class="mb-0">üí∞ C√°lculo de Pre√ßos</h5>
            </div>
            <div class="card-body">
                <h6 style="color: #667eea; margin-top: 0;"><strong>Pre√ßo Final (com desconto)</strong></h6>
                <div class="code-block">
$preco_final = $produto['preco'];
if ($produto['tipo'] == 'Usado') {
    $preco_final -= $produto['desconto_usados'];
}

$subtotal = $preco_final * $quantidade;
                </div>

                <h6 style="color: #667eea; margin-top: 20px;"><strong>Exemplo de C√°lculo</strong></h6>
                <div class="feature-box">
                    <strong>Produto:</strong> Smartphone XYZ<br>
                    <strong>Pre√ßo original:</strong> R$ 999.99<br>
                    <strong>Tipo:</strong> Usado<br>
                    <strong>Desconto para usados:</strong> R$ 100.00<br>
                    <strong>Pre√ßo final:</strong> R$ 899.99<br>
                    <strong>Quantidade:</strong> 2<br>
                    <strong>Subtotal:</strong> 2 √ó R$ 899.99 = R$ 1.799.98
                </div>
            </div>
        </div>

        <!-- Arquivos Criados -->
        <div class="card">
            <div class="card-header">
                <h5 class="mb-0">üìÅ Arquivos Criados/Modificados</h5>
            </div>
            <div class="card-body">
                <h6 style="color: #667eea;">‚úÖ NOVOS ARQUIVOS</h6>
                <div class="feature-box">
                    <strong>sistema/carrinho.php</strong><br>
                    P√°gina principal do carrinho com:<br>
                    ‚Ä¢ Listagem de itens em tabela<br>
                    ‚Ä¢ Atualiza√ß√£o de quantidades<br>
                    ‚Ä¢ Remo√ß√£o de itens<br>
                    ‚Ä¢ Finaliza√ß√£o de compra com transa√ß√£o SQL<br>
                    ‚Ä¢ Valida√ß√£o de estoque<br>
                    ‚Ä¢ Exibi√ß√£o de resumo e total
                </div>

                <h6 style="color: #667eea; margin-top: 20px;">üîÑ ARQUIVOS MODIFICADOS</h6>
                <div class="feature-box">
                    <strong>sistema/hub.php</strong><br>
                    ‚Ä¢ Adicionado link "üõí Carrinho" na navbar com contador de itens<br>
                    ‚Ä¢ Adicionado formul√°rio "+ Carrinho" em cada card de produto<br>
                    ‚Ä¢ Campo de quantidade din√¢mico (m√°x = estoque dispon√≠vel)<br>
                    ‚Ä¢ Bot√£o desabilitado para produtos sem estoque
                </div>
            </div>
        </div>

        <!-- Como Usar -->
        <div class="card">
            <div class="card-header">
                <h5 class="mb-0">üöÄ Como Usar</h5>
            </div>
            <div class="card-body">
                <h6 style="color: #667eea;"><strong>Para Cliente</strong></h6>
                <ol>
                    <li>Acesse <code>hub.php</code> ap√≥s fazer login</li>
                    <li>Procure um produto e defina a quantidade desejada</li>
                    <li>Clique "+ Carrinho"</li>
                    <li>A p√°gina redirecionar√° para carrinho.php (ou exibir√° mensagem de sucesso)</li>
                    <li>Visualize o carrinho, altere quantidades se desejar</li>
                    <li>Clique "‚úÖ Finalizar Compra"</li>
                    <li>Se houver estoque, compra √© processada com sucesso</li>
                </ol>

                <h6 style="color: #667eea; margin-top: 20px;"><strong>Valida√ß√£o de Estoque</strong></h6>
                <div class="feature-box">
                    ‚úì Campo de quantidade m√°ximo = estoque dispon√≠vel<br>
                    ‚úì Antes de finalizar, sistema verifica NOVAMENTE se ainda h√° estoque<br>
                    ‚úì Se algum produto ficou sem estoque (outro cliente comprou), exibe erro<br>
                    ‚úì Transa√ß√£o n√£o √© iniciada at√© todas valida√ß√µes passarem
                </div>

                <h6 style="color: #667eea; margin-top: 20px;"><strong>Erros Poss√≠veis</strong></h6>
                <div class="feature-box">
                    <strong style="color: #dc3545;">‚ùå Estoque Insuficiente:</strong><br>
                    Mensagem: "Estoque insuficiente para alguns itens: [lista de produtos]"<br><br>
                    <strong style="color: #dc3545;">‚ùå Erro de Banco de Dados:</strong><br>
                    Mensagem: "Erro ao finalizar compra: [detalhes t√©cnicos]"
                </div>
            </div>
        </div>

        <!-- Teste -->
        <div class="card">
            <div class="card-header">
                <h5 class="mb-0">‚úÖ Teste R√°pido</h5>
            </div>
            <div class="card-body">
                <ol>
                    <li>Fa√ßa login como cliente: <code>joao.silva@example.com / 1245</code></li>
                    <li>Abra <code>http://localhost/xampp/htdocs/loja_online/sistema/hub.php</code></li>
                    <li>Procure um produto com quantidade dispon√≠vel > 0</li>
                    <li>Clique "+ Carrinho" e veja o indicador na navbar mudar</li>
                    <li>Clique no link "üõí Carrinho" na navbar</li>
                    <li>Confirme que a tabela mostra os dados corretos (pre√ßo, loja, quantidade)</li>
                    <li>Atualize quantidades e remova itens para testar</li>
                    <li>Clique "Finalizar Compra" e veja mensagem de sucesso com n√∫mero do pedido</li>
                    <li>Verifique banco de dados: tabelas <code>Venda</code> e <code>ItemVenda</code> devem ter novos registros</li>
                    <li>Verifique <code>Estoque</code>: quantidade_dispon√≠vel deve ter diminu√≠do</li>
                </ol>
            </div>
        </div>

        <!-- Pr√≥ximos Passos -->
        <div class="card">
            <div class="card-header">
                <h5 class="mb-0">üéØ Pr√≥ximos Passos (Futuro)</h5>
            </div>
            <div class="card-body">
                <ul>
                    <li><strong>P√°gina de Pedidos:</strong> Cliente pode ver hist√≥rico de suas compras</li>
                    <li><strong>Carrinho Persistente:</strong> Guardar carrinho em BD (CarrinhoTemporario) ao inv√©s de apenas sess√£o</li>
                    <li><strong>Cupons de Desconto:</strong> Adicionar desconto por c√≥digo ou percentual</li>
                    <li><strong>Integra√ß√£o com Pagamento:</strong> PayPal, Stripe, ou gateway local</li>
                    <li><strong>Estoque em Tempo Real:</strong> Atualizar quantidade vis√≠vel sem recarregar p√°gina (AJAX)</li>
                    <li><strong>Email de Confirma√ß√£o:</strong> Enviar recibo para email do cliente</li>
                    <li><strong>Rastreamento de Pedido:</strong> Status da entrega (Pendente, Enviado, Entregue)</li>
                </ul>
            </div>
        </div>

        <div style="text-align: center; color: white; margin-top: 60px; margin-bottom: 40px;">
            <p>‚úÖ Sistema de Carrinho de Compras - Implementado com Sucesso</p>
            <p style="font-size: 0.9rem;">Loja Online ‚Ä¢ Amazon(as) ‚Ä¢ 2025</p>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.8/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>
